import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.stereotype.Service;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.time.LocalDate;
import java.time.format.DateTimeFormatter;
import java.util.ArrayList;
import java.util.List;

@Service
public class TapsTaskService {

    private static final String SQL_GET_LIST_TAPS_TASK = "SELECT tap_Id, start_date, exam_admin, end_date FROM your_table WHERE exam_admin = ?";

    @Autowired
    private JdbcTemplate jdbcTemplate;

    public List<TapsTask> getListTapsTask(String examAdmin) {
        return jdbcTemplate.query(SQL_GET_LIST_TAPS_TASK, new Object[]{examAdmin}, new RowMapper<TapsTask>() {
            @Override
            public TapsTask mapRow(ResultSet rs, int rowNum) throws SQLException {
                TapsTask tapsTask = new TapsTask();
                tapsTask.setTap_Id(rs.getLong("tap_Id"));
                tapsTask.setStart_date(rs.getString("start_date"));
                tapsTask.setExam_admin(rs.getString("exam_admin"));
                String endDate = rs.getString("end_date");
                if (endDate != null) {
                    tapsTask.setEnd_date(endDate);
                } else {
                    Logger.info("End Date is null for Taps Task id {}", tapsTask.getTap_Id());
                    LocalDate currentDate = LocalDate.now();
                    DateTimeFormatter formatter = DateTimeFormatter.ofPattern("yyyy-MM-dd");
                    String formattedDate = currentDate.format(formatter);
                    tapsTask.setEnd_date(formattedDate);
                }
                return tapsTask;
            }
        });
    }
}
